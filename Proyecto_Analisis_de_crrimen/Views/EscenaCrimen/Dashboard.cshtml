@{
    ViewBag.Title = "Dashboard";
    var totalEscenas = ViewBag.TotalEscenas ?? 0;
    var crimenesEnSerie = ViewBag.CrimenesEnSerie ?? 0;
    var ultimasEscenas = ViewBag.UltimasEscenas as List<Proyecto_Analisis_de_crimen.Models.EscenaCrimen> ?? new List<Proyecto_Analisis_de_crimen.Models.EscenaCrimen>();
}

<div class="dashboard-container">
    <div class="dashboard-header">
        <h2>DASHBOARD DE ESTADÍSTICAS DEL SISTEMA</h2>
    </div>

    <div class="dashboard-body">
        <div class="stats-grid">
            <div class="stat-card stat-primary">
                <div class="stat-icon">📊</div>
                <div class="stat-value">@totalEscenas</div>
                <div class="stat-label">ESCENAS REGISTRADAS</div>
            </div>

            <div class="stat-card stat-danger">
                <div class="stat-icon">⚠</div>
                <div class="stat-value">@crimenesEnSerie</div>
                <div class="stat-label">CRÍMENES EN SERIE</div>
            </div>

            <div class="stat-card stat-info">
                <div class="stat-icon">🔔</div>
                <div class="stat-value">@(crimenesEnSerie > 0 ? crimenesEnSerie * 2 : 0)</div>
                <div class="stat-label">ALERTAS ACTIVAS</div>
            </div>

            <div class="stat-card stat-success">
                <div class="stat-icon">👥</div>
                <div class="stat-value">@(User.Identity.IsAuthenticated ? "1" : "0")</div>
                <div class="stat-label">USUARIOS EN LÍNEA</div>
            </div>
        </div>

        <div class="content-grid">
            <div class="activity-panel">
                <div class="panel-header">
                    <h4>ACTIVIDAD RECIENTE DEL SISTEMA</h4>
                </div>
                <div class="panel-body">
                    @if (ultimasEscenas.Any())
                    {
                        @foreach (var escena in ultimasEscenas)
                        {
                            <div class="activity-item">
                                <div class="activity-icon">📝</div>
                                <div class="activity-details">
                                    <div class="activity-text">
                                        Escena #@escena.Id registrada - @escena.TipoCrimen en @escena.AreaGeografica
                                    </div>
                                    <div class="activity-time">
                                        @{
                                            var diferencia = DateTime.Now - escena.FechaRegistro;
                                            var tiempo = diferencia.TotalHours < 1 ?
                                            $"Hace {(int)diferencia.TotalMinutes} minutos" :
                                            diferencia.TotalDays < 1 ?
                                            $"Hace {(int)diferencia.TotalHours} horas" :
                                            $"Hace {(int)diferencia.TotalDays} días";
                                        }
                                        @tiempo - Por @escena.UsuarioRegistro
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="no-activity">
                            <p>No hay actividad reciente registrada</p>
                        </div>
                    }
                </div>
            </div>

            <div class="analysis-panel">
                <div class="panel-header">
                    <h4>ANÁLISIS RÁPIDO</h4>
                </div>
                <div class="panel-body">
                    <div class="quick-stats">
                        <div class="quick-stat-item">
                            <div class="quick-stat-label">Tasa de Detección</div>
                            <div class="quick-stat-value">
                                @if (totalEscenas > 0)
                                {
                                    var tasa = ((double)crimenesEnSerie / totalEscenas) * 100;
                                    @tasa.ToString("F1")
                                
                                    <span class="percentage">%</span>
                                }
                                else
                                {
                                    <span>0.0<span class="percentage">%</span></span>
                                }
                            </div>
                        </div>

                        <div class="quick-stat-item">
                            <div class="quick-stat-label">Promedio Mensual</div>
                            <div class="quick-stat-value">
                                @{
                                    var promedioMensual = totalEscenas / Math.Max(1, DateTime.Now.Month);
                                }
                                @promedioMensual
                            </div>
                        </div>

                        <div class="quick-stat-item">
                            <div class="quick-stat-label">Casos Activos</div>
                            <div class="quick-stat-value">@totalEscenas</div>
                        </div>
                    </div>

                    <div class="alert-panel">
                        @if (crimenesEnSerie > 0)
                        {
                            <div class="alert alert-danger">
                                <strong>⚠ ALERTA CRÍTICA</strong><br>
                                Se han detectado @crimenesEnSerie patrones de crímenes en serie activos.
                                Se recomienda revisión inmediata.
                            </div>
                        }
                        else
                        {
                            <div class="alert alert-success">
                                <strong>✓ SISTEMA ESTABLE</strong><br>
                                No se han detectado patrones críticos de crímenes en serie.
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="actions-section">
            <h4>ACCIONES RÁPIDAS</h4>
            <div class="actions-buttons">
                @Html.ActionLink("REGISTRAR ESCENA", "Registrar", null, new { @class = "btn btn-primary" })
                @Html.ActionLink("COMPARAR ESCENAS", "Comparar", null, new { @class = "btn btn-info" })
                @Html.ActionLink("VER TODAS", "Index", null, new { @class = "btn btn-secondary" })
            </div>
        </div>
    </div>
</div>

<style>
    .dashboard-container {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-top: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .dashboard-header {
        background: #1a3a52;
        color: white;
        padding: 20px;
        border-bottom: 2px solid #2c5aa0;
    }

        .dashboard-header h2 {
            margin: 0;
            font-size: 1.5em;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

    .dashboard-body {
        padding: 30px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        padding: 25px;
        border-radius: 4px;
        text-align: center;
        color: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stat-primary {
        background: linear-gradient(135deg, #1a3a52 0%, #2c5aa0 100%);
    }

    .stat-danger {
        background: linear-gradient(135deg, #8b0000 0%, #b30000 100%);
    }

    .stat-info {
        background: linear-gradient(135deg, #2c5aa0 0%, #4a7bc8 100%);
    }

    .stat-success {
        background: linear-gradient(135deg, #2d6a4f 0%, #40916c 100%);
    }

    .stat-icon {
        font-size: 2.5em;
        margin-bottom: 10px;
    }

    .stat-value {
        font-size: 2.5em;
        font-weight: 700;
        margin-bottom: 5px;
        line-height: 1;
    }

    .stat-label {
        font-size: 0.85em;
        opacity: 0.9;
        letter-spacing: 0.3px;
        font-weight: 600;
    }

    .content-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
    }

    .activity-panel, .analysis-panel {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        overflow: hidden;
    }

    .panel-header {
        background: #e9ecef;
        padding: 15px 20px;
        border-bottom: 1px solid #dee2e6;
    }

        .panel-header h4 {
            margin: 0;
            color: #1a3a52;
            font-weight: 700;
            font-size: 1em;
            letter-spacing: 0.3px;
        }

    .panel-body {
        padding: 20px;
    }

    .activity-item {
        display: flex;
        gap: 15px;
        padding: 15px;
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        margin-bottom: 10px;
    }

    .activity-icon {
        font-size: 1.5em;
        flex-shrink: 0;
    }

    .activity-details {
        flex: 1;
    }

    .activity-text {
        color: #333;
        font-weight: 500;
        margin-bottom: 5px;
        font-size: 0.95em;
    }

    .activity-time {
        color: #6c757d;
        font-size: 0.85em;
    }

    .no-activity {
        text-align: center;
        padding: 40px 20px;
        color: #6c757d;
    }

    .quick-stats {
        display: grid;
        gap: 15px;
        margin-bottom: 20px;
    }

    .quick-stat-item {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .quick-stat-label {
        color: #555;
        font-weight: 600;
        font-size: 0.95em;
    }

    .quick-stat-value {
        font-size: 1.8em;
        font-weight: 700;
        color: #1a3a52;
    }

    .percentage {
        font-size: 0.6em;
        color: #6c757d;
    }

    .alert-panel {
        margin-top: 15px;
    }

    .alert {
        padding: 15px;
        border-radius: 4px;
        border: 1px solid;
    }

    .alert-danger {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
    }

    .alert-success {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
    }

    .alert strong {
        display: block;
        margin-bottom: 5px;
    }

    .actions-section {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 20px;
    }

        .actions-section h4 {
            color: #1a3a52;
            font-weight: 700;
            margin-bottom: 15px;
        }

    .actions-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
    }

    .btn {
        padding: 12px 25px;
        border-radius: 4px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        border: none;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
    }

    .btn-primary {
        background-color: #1a3a52;
        color: white;
    }

        .btn-primary:hover {
            background-color: #2c5aa0;
            color: white;
            text-decoration: none;
        }

    .btn-info {
        background-color: #2c5aa0;
        color: white;
    }

        .btn-info:hover {
            background-color: #4a7bc8;
            color: white;
            text-decoration: none;
        }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }

        .btn-secondary:hover {
            background-color: #5a6268;
            color: white;
            text-decoration: none;
        }

    @@media (max-width: 1200px) {
        .stats-grid

    {
        grid-template-columns: repeat(2, 1fr);
    }

    .content-grid {
        grid-template-columns: 1fr;
    }

    }

    @@media (max-width: 768px) {
        .stats-grid

    {
        grid-template-columns: 1fr;
    }

    .actions-buttons {
        flex-direction: column;
    }

    }
</style>